<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Management - Woofalytics</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'></text></svg>">
    <style>
        /* ===== Dog Management Page - Refined Design ===== */

        /* Page-specific overrides */
        .dogs-page {
            --card-bg: rgba(22, 27, 34, 0.6);
            --card-bg-hover: rgba(28, 33, 40, 0.8);
            --badge-success-bg: rgba(16, 185, 129, 0.12);
            --badge-success-border: rgba(16, 185, 129, 0.25);
            --badge-success-text: #10b981;
            --badge-warning-bg: rgba(245, 158, 11, 0.12);
            --badge-warning-border: rgba(245, 158, 11, 0.25);
            --badge-warning-text: #f59e0b;
            --badge-muted-bg: rgba(100, 116, 139, 0.12);
            --badge-muted-border: rgba(100, 116, 139, 0.25);
            --badge-muted-text: #64748b;
        }

        /* Stats Row - Horizontal compact layout */
        .stats-row {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            padding: var(--space-md) var(--space-lg);
            background: var(--card-bg);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(20px);
        }

        .stat-pill {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-xs) var(--space-md);
            background: var(--bg-overlay);
            border-radius: var(--radius-full);
        }

        .stat-pill-value {
            font-size: 1.25rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-primary);
        }

        .stat-pill-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .stat-pill--dogs .stat-pill-value { color: var(--accent-amber); }
        .stat-pill--untagged .stat-pill-value { color: var(--accent-coral); }
        .stat-pill--total .stat-pill-value { color: var(--accent-teal); }

        /* Main Layout - Two Column with Priority */
        .dogs-layout {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: var(--space-lg);
            flex: 1;
        }

        @media (max-width: 1100px) {
            .dogs-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Section Panels */
        .dogs-section {
            display: flex;
            flex-direction: column;
            background: var(--card-bg);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(20px);
            overflow: hidden;
        }

        .dogs-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--border-muted);
            background: rgba(0, 0, 0, 0.2);
        }

        .dogs-section-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .dogs-section-title svg {
            width: 18px;
            height: 18px;
            color: var(--accent-amber);
        }

        .dogs-section-count {
            font-size: 0.7rem;
            font-weight: 600;
            padding: 2px 8px;
            background: var(--bg-overlay);
            border-radius: var(--radius-full);
            color: var(--text-muted);
        }

        .dogs-section-body {
            flex: 1;
            padding: var(--space-md);
            overflow-y: auto;
            max-height: 600px;
        }

        /* Add Dog Form - Compact Inline */
        .add-dog-form {
            display: flex;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            margin: var(--space-sm);
            background: var(--bg-overlay);
            border-radius: var(--radius-md);
            border: 1px dashed var(--border-default);
        }

        .add-dog-form .form-input {
            flex: 1;
            padding: var(--space-sm) var(--space-md);
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 0.875rem;
            min-width: 0;
        }

        .add-dog-form .form-input:focus {
            outline: none;
            border-color: var(--accent-amber);
        }

        .add-dog-form .form-input::placeholder {
            color: var(--text-muted);
        }

        .add-dog-form .btn-add {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: var(--accent-amber);
            border: none;
            border-radius: var(--radius-sm);
            color: var(--bg-base);
            cursor: pointer;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .add-dog-form .btn-add:hover {
            background: #fbbf24;
            transform: scale(1.05);
        }

        .add-dog-form .btn-add svg {
            width: 18px;
            height: 18px;
        }

        /* Dog Card - Refined */
        .dog-card-v2 {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: transparent;
            border-radius: var(--radius-md);
            border: 1px solid transparent;
            transition: all var(--transition-fast);
            margin-bottom: var(--space-xs);
        }

        .dog-card-v2:hover {
            background: var(--card-bg-hover);
            border-color: var(--border-default);
        }

        .dog-card-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-amber-dim), rgba(245, 158, 11, 0.25));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
            border: 2px solid var(--accent-amber-dim);
        }

        .dog-card-content {
            flex: 1;
            min-width: 0;
        }

        .dog-card-header {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: 2px;
        }

        .dog-card-name {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dog-card-notes {
            font-size: 0.75rem;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Status Badge V2 */
        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            border-radius: var(--radius-full);
            border: 1px solid;
            white-space: nowrap;
        }

        .status-chip svg {
            width: 10px;
            height: 10px;
        }

        .status-chip--active {
            background: var(--badge-success-bg);
            border-color: var(--badge-success-border);
            color: var(--badge-success-text);
        }

        .status-chip--pending {
            background: var(--badge-warning-bg);
            border-color: var(--badge-warning-border);
            color: var(--badge-warning-text);
        }

        .status-chip--inactive {
            background: var(--badge-muted-bg);
            border-color: var(--badge-muted-border);
            color: var(--badge-muted-text);
        }

        /* Dog Stats Row */
        .dog-card-stats {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-top: 4px;
        }

        .dog-stat {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .dog-stat strong {
            font-weight: 600;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .dog-stat svg {
            width: 12px;
            height: 12px;
            opacity: 0.6;
        }

        /* Dog Card Actions */
        .dog-card-actions {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            flex-shrink: 0;
        }

        .btn-action {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: var(--space-xs) var(--space-sm);
            font-size: 0.7rem;
            font-weight: 600;
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .btn-action svg {
            width: 12px;
            height: 12px;
        }

        .btn-action:hover {
            background: var(--bg-overlay);
            color: var(--text-primary);
            border-color: var(--text-muted);
        }

        .btn-action--primary {
            background: var(--accent-amber);
            border-color: var(--accent-amber);
            color: var(--bg-base);
        }

        .btn-action--primary:hover {
            background: #fbbf24;
            border-color: #fbbf24;
        }

        .btn-action--teal {
            background: var(--accent-teal-dim);
            border-color: var(--accent-teal);
            color: var(--accent-teal);
        }

        .btn-action--teal:hover {
            background: var(--accent-teal);
            color: var(--bg-base);
        }

        .btn-action--danger {
            color: var(--accent-coral);
            border-color: var(--accent-coral-dim);
        }

        .btn-action--danger:hover {
            background: var(--accent-coral-dim);
            border-color: var(--accent-coral);
        }

        /* More Actions Dropdown */
        .actions-menu {
            position: relative;
        }

        .actions-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            min-width: 140px;
            margin-top: 4px;
            padding: var(--space-xs);
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all var(--transition-fast);
        }

        .actions-menu.open .actions-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: left;
        }

        .dropdown-item svg {
            width: 14px;
            height: 14px;
        }

        .dropdown-item:hover {
            background: var(--bg-overlay);
            color: var(--text-primary);
        }

        .dropdown-item--danger:hover {
            background: var(--accent-coral-dim);
            color: var(--accent-coral);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--border-muted);
            margin: var(--space-xs) 0;
        }

        /* Bark Card V2 */
        .bark-card-v2 {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--bg-overlay);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--accent-coral);
            margin-bottom: var(--space-sm);
            transition: all var(--transition-fast);
        }

        .bark-card-v2:hover {
            background: var(--card-bg-hover);
        }

        .bark-icon {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            background: var(--accent-coral-dim);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .bark-icon svg {
            width: 16px;
            height: 16px;
            color: var(--accent-coral);
        }

        .bark-content {
            flex: 1;
            min-width: 0;
        }

        .bark-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-sm);
            margin-bottom: 4px;
        }

        .bark-time {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .bark-prob {
            font-size: 0.65rem;
            font-weight: 600;
            padding: 2px 6px;
            background: var(--accent-teal-dim);
            color: var(--accent-teal);
            border-radius: var(--radius-full);
        }

        .bark-meta {
            display: flex;
            gap: var(--space-md);
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: var(--space-sm);
        }

        .bark-meta a {
            color: var(--accent-blue);
            text-decoration: none;
        }

        .bark-meta a:hover {
            text-decoration: underline;
        }

        /* Tag Select Dropdown */
        .tag-select {
            position: relative;
            min-width: 140px;
            flex-shrink: 0;
        }

        .tag-select-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-sm);
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .tag-select-trigger:hover {
            border-color: var(--accent-amber);
            color: var(--text-primary);
        }

        .tag-select-trigger svg {
            width: 12px;
            height: 12px;
            transition: transform var(--transition-fast);
        }

        .tag-select.open .tag-select-trigger svg {
            transform: rotate(180deg);
        }

        .tag-select-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 4px;
            padding: var(--space-xs);
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all var(--transition-fast);
            max-height: 200px;
            overflow-y: auto;
        }

        .tag-select.open .tag-select-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .tag-option {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: left;
        }

        .tag-option:hover {
            background: var(--accent-amber-dim);
            color: var(--accent-amber);
        }

        /* Modal V2 */
        .modal-v2 {
            max-width: 640px;
            width: 95%;
            max-height: 85vh;
            background: var(--bg-surface);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg), 0 0 0 1px rgba(20, 184, 166, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--border-muted);
            background: rgba(0, 0, 0, 0.3);
        }

        .modal-title-v2 {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-title-v2 svg {
            width: 20px;
            height: 20px;
            color: var(--accent-teal);
        }

        .modal-close {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: transparent;
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background: var(--bg-overlay);
            color: var(--text-primary);
        }

        .modal-close svg {
            width: 14px;
            height: 14px;
        }

        .modal-body {
            flex: 1;
            padding: var(--space-md) var(--space-lg);
            overflow-y: auto;
        }

        .modal-footer {
            padding: var(--space-md) var(--space-lg);
            border-top: 1px solid var(--border-muted);
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: flex-end;
            gap: var(--space-sm);
        }

        /* Empty States */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-2xl) var(--space-lg);
            text-align: center;
        }

        .empty-state-icon {
            width: 48px;
            height: 48px;
            margin-bottom: var(--space-md);
            color: var(--text-muted);
            opacity: 0.4;
        }

        .empty-state-text {
            font-size: 0.875rem;
            color: var(--text-muted);
            line-height: 1.5;
        }

        /* Loading State */
        .loading-state {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-xl);
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--border-default);
            border-top-color: var(--accent-teal);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-row {
                flex-wrap: wrap;
                gap: var(--space-sm);
            }

            .dog-card-v2 {
                flex-wrap: wrap;
            }

            .dog-card-actions {
                width: 100%;
                justify-content: flex-start;
                margin-top: var(--space-sm);
                padding-top: var(--space-sm);
                border-top: 1px solid var(--border-muted);
            }
        }
    </style>
</head>
<body class="dogs-page">
    <!-- Telemetry Strip -->
    <div class="telemetry-strip">
        <div class="telemetry-mission">
            <span class="mission-badge">WOOFALYTICS</span>
            <span class="mission-callsign">DOG MANAGEMENT</span>
        </div>
        <div class="telemetry-status">
            <a href="/" class="btn-sm btn-outline" style="text-decoration: none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Dashboard
            </a>
            <a href="/fingerprints.html" class="btn-sm btn-outline" style="text-decoration: none; margin-left: 8px;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px">
                    <path d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3"/>
                </svg>
                Fingerprints
            </a>
        </div>
    </div>

    <div class="app">
        <header class="header">
            <div class="brand">
                <svg class="brand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                    <line x1="9" y1="9" x2="9.01" y2="9"/>
                    <line x1="15" y1="9" x2="15.01" y2="9"/>
                </svg>
                <h1>Dog Management</h1>
            </div>
        </header>

        <!-- Stats Row -->
        <div class="stats-row">
            <div class="stat-pill stat-pill--dogs">
                <span class="stat-pill-value" id="stat-dogs">0</span>
                <span class="stat-pill-label">Dogs</span>
            </div>
            <div class="stat-pill stat-pill--untagged">
                <span class="stat-pill-value" id="stat-untagged">0</span>
                <span class="stat-pill-label">Untagged</span>
            </div>
            <div class="stat-pill stat-pill--total">
                <span class="stat-pill-value" id="stat-total">0</span>
                <span class="stat-pill-label">Fingerprints</span>
            </div>
        </div>

        <main class="dogs-layout">
            <!-- Dog Profiles Section -->
            <section class="dogs-section">
                <div class="dogs-section-header">
                    <h2 class="dogs-section-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                            <line x1="9" y1="9" x2="9.01" y2="9"/>
                            <line x1="15" y1="9" x2="15.01" y2="9"/>
                        </svg>
                        Dog Profiles
                    </h2>
                    <span class="dogs-section-count" id="dogs-count">0</span>
                </div>

                <!-- Add Dog Form -->
                <form id="add-dog-form" class="add-dog-form">
                    <input type="text" class="form-input" id="new-dog-name" placeholder="Dog name..." required>
                    <input type="text" class="form-input" id="new-dog-notes" placeholder="Notes (optional)" style="flex: 0.8;">
                    <button type="submit" class="btn-add" title="Add Dog">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                    </button>
                </form>

                <div class="dogs-section-body" id="dogs-list">
                    <div class="empty-state">
                        <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                            <line x1="9" y1="9" x2="9.01" y2="9"/>
                            <line x1="15" y1="9" x2="15.01" y2="9"/>
                        </svg>
                        <span class="empty-state-text">No dogs registered yet.<br>Add your first dog above!</span>
                    </div>
                </div>
            </section>

            <!-- Untagged Barks Section -->
            <section class="dogs-section">
                <div class="dogs-section-header">
                    <h2 class="dogs-section-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                            <path d="M15.54 8.46a5 5 0 010 7.07"/>
                        </svg>
                        Untagged Barks
                    </h2>
                    <span class="dogs-section-count" id="barks-count">0</span>
                </div>

                <div class="dogs-section-body" id="barks-list">
                    <div class="empty-state">
                        <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        <span class="empty-state-text">All barks have been reviewed!</span>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <span>Woofalytics v2.0.0</span>
            <span class="footer-divider">路</span>
            <a href="/">Dashboard</a>
            <span class="footer-divider">路</span>
            <a href="/fingerprints.html">Fingerprints</a>
            <span class="footer-divider">路</span>
            <a href="/settings.html">Settings</a>
            <span class="footer-divider">路</span>
            <a href="/api/docs">API Documentation</a>
        </footer>
    </div>

    <!-- View Barks Modal -->
    <div class="modal-backdrop" id="barks-modal">
        <div class="modal-v2">
            <div class="modal-header">
                <h3 class="modal-title-v2">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                        <path d="M15.54 8.46a5 5 0 010 7.07"/>
                    </svg>
                    <span id="barks-modal-title">Dog Barks</span>
                </h3>
                <button type="button" class="modal-close" onclick="closeBarkModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="barks-modal-content">
                <!-- Barks will be rendered here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeBarkModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Edit Dog Modal -->
    <div class="modal-backdrop" id="edit-modal">
        <div class="modal-v2" style="max-width: 420px;">
            <div class="modal-header">
                <h3 class="modal-title-v2">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                        <path d="M18.5 2.5a2.12 2.12 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    Edit Dog Profile
                </h3>
                <button type="button" class="modal-close" onclick="closeEditModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <form id="edit-dog-form">
                <div class="modal-body">
                    <input type="hidden" id="edit-dog-id">
                    <div class="form-group">
                        <label class="form-label">Dog Name</label>
                        <input type="text" class="form-input" id="edit-dog-name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <textarea class="form-input form-textarea" id="edit-dog-notes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="btn btn-amber">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    /**
     * Dog Management Admin - Refined UI
     */
    class DogsAdmin {
        constructor() {
            this.dogs = [];
            this.untaggedBarks = [];
            this.openDropdowns = new Set();
            this.init();
        }

        async init() {
            // Load dogs first, then untagged barks (which needs dogs for dropdown)
            await this.loadDogs();
            await this.loadUntaggedBarks();
            this.loadStats();
            this.setupEventListeners();

            // Refresh every 30 seconds
            setInterval(async () => {
                await this.loadDogs();
                await this.loadUntaggedBarks();
                this.loadStats();
            }, 30000);
        }

        setupEventListeners() {
            // Add dog form
            document.getElementById('add-dog-form').addEventListener('submit', (e) => {
                e.preventDefault();
                this.addDog();
            });

            // Edit dog form
            document.getElementById('edit-dog-form').addEventListener('submit', (e) => {
                e.preventDefault();
                this.saveDogEdit();
            });

            // Close modals on backdrop click
            document.getElementById('edit-modal').addEventListener('click', (e) => {
                if (e.target.id === 'edit-modal') closeEditModal();
            });

            document.getElementById('barks-modal').addEventListener('click', (e) => {
                if (e.target.id === 'barks-modal') closeBarkModal();
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.actions-menu') && !e.target.closest('.tag-select')) {
                    this.closeAllDropdowns();
                }
            });
        }

        closeAllDropdowns() {
            document.querySelectorAll('.actions-menu.open, .tag-select.open').forEach(el => {
                el.classList.remove('open');
            });
            this.openDropdowns.clear();
        }

        toggleDropdown(element, id) {
            const isOpen = element.classList.contains('open');
            this.closeAllDropdowns();
            if (!isOpen) {
                element.classList.add('open');
                this.openDropdowns.add(id);
            }
        }

        async loadStats() {
            try {
                const response = await fetch('/api/fingerprints/stats');
                if (!response.ok) return;
                const data = await response.json();

                document.getElementById('stat-dogs').textContent = data.dogs || 0;
                document.getElementById('stat-untagged').textContent = data.untagged || 0;
                document.getElementById('stat-total').textContent = data.fingerprints || 0;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async loadDogs() {
            try {
                const response = await fetch('/api/dogs');
                if (!response.ok) return;
                const data = await response.json();

                this.dogs = Array.isArray(data) ? data : (data.dogs || []);
                document.getElementById('dogs-count').textContent = this.dogs.length;
                this.renderDogs();
            } catch (error) {
                console.error('Error loading dogs:', error);
            }
        }

        renderDogs() {
            const container = document.getElementById('dogs-list');

            if (this.dogs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                        </svg>
                        <span class="empty-state-text">No dogs registered yet.<br>Add your first dog above!</span>
                    </div>
                `;
                return;
            }

            const html = this.dogs.map(dog => {
                const lastSeen = dog.last_seen
                    ? this.formatRelativeTime(new Date(dog.last_seen))
                    : 'Never';

                // Status chip
                let statusChip = '';
                if (dog.can_auto_tag) {
                    statusChip = `<span class="status-chip status-chip--active">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        Auto-Tag
                    </span>`;
                } else if (dog.confirmed) {
                    const progress = `${dog.sample_count}/${dog.min_samples_for_auto_tag}`;
                    statusChip = `<span class="status-chip status-chip--pending">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        ${progress}
                    </span>`;
                } else {
                    statusChip = `<span class="status-chip status-chip--inactive">Unconfirmed</span>`;
                }

                // Primary action
                const primaryBtn = dog.confirmed
                    ? `<button class="btn-action btn-action--teal" onclick="admin.viewBarks('${dog.id}')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                        </svg>
                        Barks (${dog.total_barks || 0})
                    </button>`
                    : `<button class="btn-action btn-action--primary" onclick="admin.confirmDog('${dog.id}')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        Confirm
                    </button>`;

                return `
                    <div class="dog-card-v2" data-dog-id="${dog.id}">
                        <div class="dog-card-avatar"></div>
                        <div class="dog-card-content">
                            <div class="dog-card-header">
                                <span class="dog-card-name">${this.escapeHtml(dog.name)}</span>
                                ${statusChip}
                            </div>
                            ${dog.notes ? `<div class="dog-card-notes">${this.escapeHtml(dog.notes)}</div>` : ''}
                            <div class="dog-card-stats">
                                <div class="dog-stat">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                                    </svg>
                                    <strong>${dog.total_barks || 0}</strong> barks
                                </div>
                                <div class="dog-stat">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                    ${lastSeen}
                                </div>
                            </div>
                        </div>
                        <div class="dog-card-actions">
                            ${primaryBtn}
                            ${dog.confirmed ? `
                                <button class="btn-action" onclick="admin.viewBarks('${dog.id}')" style="display:none;"></button>
                            ` : `
                                <button class="btn-action btn-action--teal" onclick="admin.viewBarks('${dog.id}')">
                                    Barks
                                </button>
                            `}
                            <div class="actions-menu">
                                <button class="btn-action" onclick="admin.toggleDropdown(this.parentElement, '${dog.id}'); event.stopPropagation();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="1"/>
                                        <circle cx="12" cy="5" r="1"/>
                                        <circle cx="12" cy="19" r="1"/>
                                    </svg>
                                </button>
                                <div class="actions-dropdown">
                                    <button class="dropdown-item" onclick="admin.editDog('${dog.id}')">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                                            <path d="M18.5 2.5a2.12 2.12 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                        </svg>
                                        Edit Profile
                                    </button>
                                    ${dog.confirmed ? `
                                        <button class="dropdown-item" onclick="admin.unconfirmDog('${dog.id}')">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"/>
                                                <line x1="15" y1="9" x2="9" y2="15"/>
                                                <line x1="9" y1="9" x2="15" y2="15"/>
                                            </svg>
                                            Remove Confirmation
                                        </button>
                                    ` : `
                                        <button class="dropdown-item" onclick="admin.confirmDog('${dog.id}')">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                                                <polyline points="22 4 12 14.01 9 11.01"/>
                                            </svg>
                                            Confirm Dog
                                        </button>
                                    `}
                                    <div class="dropdown-divider"></div>
                                    <button class="dropdown-item dropdown-item--danger" onclick="admin.deleteDog('${dog.id}')">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="3 6 5 6 21 6"/>
                                            <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                        </svg>
                                        Delete Dog
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        async loadUntaggedBarks() {
            try {
                const response = await fetch('/api/barks/untagged?limit=20');
                if (!response.ok) return;
                const data = await response.json();

                this.untaggedBarks = data.barks || [];
                document.getElementById('barks-count').textContent = this.untaggedBarks.length;
                this.renderUntaggedBarks();
            } catch (error) {
                console.error('Error loading untagged barks:', error);
            }
        }

        renderUntaggedBarks() {
            const container = document.getElementById('barks-list');

            if (this.untaggedBarks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        <span class="empty-state-text">All barks have been reviewed!</span>
                    </div>
                `;
                return;
            }

            const html = this.untaggedBarks.map(bark => {
                const time = this.formatTime(new Date(bark.timestamp));
                const prob = bark.detection_probability
                    ? (bark.detection_probability * 100).toFixed(0) + '%'
                    : '--';

                // Dog dropdown options
                const dogOptions = this.dogs.map(dog => `
                    <button class="tag-option" onclick="admin.tagBark('${bark.id}', '${dog.id}'); event.stopPropagation();">
                         ${this.escapeHtml(dog.name)}
                    </button>
                `).join('');

                return `
                    <div class="bark-card-v2" data-bark-id="${bark.id}">
                        <div class="bark-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                                <path d="M15.54 8.46a5 5 0 010 7.07"/>
                            </svg>
                        </div>
                        <div class="bark-content">
                            <div class="bark-header">
                                <span class="bark-time">${time}</span>
                                <span class="bark-prob">${prob}</span>
                            </div>
                            <div class="bark-meta">
                                ${bark.evidence_filename ? `
                                    <a href="/api/evidence/${bark.evidence_filename}" target="_blank">
                                        Play recording
                                    </a>
                                ` : ''}
                                ${bark.doa_degrees !== null ? `<span>Direction: ${bark.doa_degrees}掳</span>` : ''}
                            </div>
                        </div>
                        ${this.dogs.length > 0 ? `
                            <div class="tag-select">
                                <button class="tag-select-trigger" onclick="admin.toggleDropdown(this.parentElement, 'bark-${bark.id}'); event.stopPropagation();">
                                    Assign to dog
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"/>
                                    </svg>
                                </button>
                                <div class="tag-select-menu">
                                    ${dogOptions}
                                </div>
                            </div>
                        ` : `
                            <span style="font-size: 0.75rem; color: var(--text-muted);">Add dogs first</span>
                        `}
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        formatTime(date) {
            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
        }

        formatRelativeTime(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            return date.toLocaleDateString();
        }

        async addDog() {
            const nameInput = document.getElementById('new-dog-name');
            const notesInput = document.getElementById('new-dog-notes');

            const name = nameInput.value.trim();
            const notes = notesInput.value.trim();

            if (!name) return;

            try {
                const response = await fetch('/api/dogs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, notes })
                });

                if (response.ok) {
                    nameInput.value = '';
                    notesInput.value = '';
                    await this.loadDogs();
                    await this.loadStats();
                    this.renderUntaggedBarks();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.detail || 'Failed to add dog'));
                }
            } catch (error) {
                console.error('Error adding dog:', error);
                alert('Error adding dog');
            }
        }

        editDog(dogId) {
            this.closeAllDropdowns();
            const dog = this.dogs.find(d => d.id === dogId);
            if (!dog) return;

            document.getElementById('edit-dog-id').value = dog.id;
            document.getElementById('edit-dog-name').value = dog.name;
            document.getElementById('edit-dog-notes').value = dog.notes || '';
            document.getElementById('edit-modal').classList.add('active');
        }

        async saveDogEdit() {
            const dogId = document.getElementById('edit-dog-id').value;
            const name = document.getElementById('edit-dog-name').value.trim();
            const notes = document.getElementById('edit-dog-notes').value.trim();

            if (!name) return;

            try {
                const response = await fetch(`/api/dogs/${dogId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, notes })
                });

                if (response.ok) {
                    closeEditModal();
                    await this.loadDogs();
                    this.renderUntaggedBarks();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.detail || 'Failed to update dog'));
                }
            } catch (error) {
                console.error('Error updating dog:', error);
                alert('Error updating dog');
            }
        }

        async deleteDog(dogId) {
            this.closeAllDropdowns();
            const dog = this.dogs.find(d => d.id === dogId);
            if (!dog) return;

            if (!confirm(`Delete "${dog.name}"? This will remove the dog profile but keep the bark recordings.`)) {
                return;
            }

            try {
                const response = await fetch(`/api/dogs/${dogId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    await this.loadDogs();
                    await this.loadStats();
                    await this.loadUntaggedBarks();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.detail || 'Failed to delete dog'));
                }
            } catch (error) {
                console.error('Error deleting dog:', error);
                alert('Error deleting dog');
            }
        }

        async confirmDog(dogId) {
            this.closeAllDropdowns();
            const dog = this.dogs.find(d => d.id === dogId);
            if (!dog) return;

            const minSamples = dog.sample_count < 5
                ? prompt(`Confirm "${dog.name}" for auto-tagging?\n\nThis dog has ${dog.sample_count} samples. How many samples should be required before auto-tagging? (default: 5)`, '5')
                : null;

            if (minSamples === null && dog.sample_count < 5) return;

            try {
                const response = await fetch(`/api/dogs/${dogId}/confirm`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ min_samples: minSamples ? parseInt(minSamples) : null })
                });

                if (response.ok) {
                    await this.loadDogs();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.detail || 'Failed to confirm dog'));
                }
            } catch (error) {
                console.error('Error confirming dog:', error);
                alert('Error confirming dog');
            }
        }

        async unconfirmDog(dogId) {
            this.closeAllDropdowns();
            const dog = this.dogs.find(d => d.id === dogId);
            if (!dog) return;

            if (!confirm(`Remove confirmation from "${dog.name}"? This will disable auto-tagging for this dog.`)) {
                return;
            }

            try {
                const response = await fetch(`/api/dogs/${dogId}/unconfirm`, {
                    method: 'POST'
                });

                if (response.ok) {
                    await this.loadDogs();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.detail || 'Failed to unconfirm dog'));
                }
            } catch (error) {
                console.error('Error unconfirming dog:', error);
                alert('Error unconfirming dog');
            }
        }

        async tagBark(barkId, dogId) {
            this.closeAllDropdowns();
            try {
                const response = await fetch(`/api/barks/${barkId}/tag`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ dog_id: dogId })
                });

                if (response.ok) {
                    await this.loadUntaggedBarks();
                    await this.loadDogs();
                    await this.loadStats();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.detail || 'Failed to tag bark'));
                }
            } catch (error) {
                console.error('Error tagging bark:', error);
                alert('Error tagging bark');
            }
        }

        async viewBarks(dogId) {
            this.closeAllDropdowns();
            const dog = this.dogs.find(d => d.id === dogId);
            if (!dog) return;

            document.getElementById('barks-modal-title').textContent = `${dog.name}'s Barks (${dog.total_barks || 0})`;
            document.getElementById('barks-modal-content').innerHTML = `
                <div class="loading-state">
                    <div class="spinner"></div>
                    <span>Loading barks...</span>
                </div>
            `;
            document.getElementById('barks-modal').classList.add('active');

            try {
                const response = await fetch(`/api/dogs/${dogId}/barks?limit=100`);
                if (!response.ok) throw new Error('Failed to load barks');
                const data = await response.json();

                this.renderDogBarks(dog, data.barks || []);
            } catch (error) {
                console.error('Error loading dog barks:', error);
                document.getElementById('barks-modal-content').innerHTML = `
                    <div class="empty-state">
                        <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--accent-coral);">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                        <span class="empty-state-text">Error loading barks: ${error.message}</span>
                    </div>
                `;
            }
        }

        renderDogBarks(dog, barks) {
            const container = document.getElementById('barks-modal-content');

            if (barks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                        </svg>
                        <span class="empty-state-text">No barks recorded for this dog yet.</span>
                    </div>
                `;
                return;
            }

            const html = barks.map(bark => {
                const time = this.formatTime(new Date(bark.timestamp));
                const confidence = bark.match_confidence
                    ? (bark.match_confidence * 100).toFixed(0) + '%'
                    : '--';
                const detection = bark.detection_probability
                    ? (bark.detection_probability * 100).toFixed(0) + '%'
                    : '--';
                const doa = bark.doa_degrees !== null ? `${bark.doa_degrees}掳` : '--';

                return `
                    <div class="bark-card-v2" data-bark-id="${bark.id}">
                        <div class="bark-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                            </svg>
                        </div>
                        <div class="bark-content" style="flex: 1;">
                            <div class="bark-header">
                                <span class="bark-time">${time}</span>
                                <span class="bark-prob" title="Match confidence">${confidence}</span>
                            </div>
                            <div class="bark-meta">
                                <span>Detection: <strong>${detection}</strong></span>
                                <span>Direction: <strong>${doa}</strong></span>
                            </div>
                        </div>
                        <button class="btn-action btn-action--danger" onclick="admin.untagBark('${bark.id}', '${dog.id}')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="15" y1="9" x2="9" y2="15"/>
                                <line x1="9" y1="9" x2="15" y2="15"/>
                            </svg>
                            Untag
                        </button>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        async untagBark(barkId, dogId) {
            if (!confirm('Untag this bark? It will be moved to the untagged barks list.')) {
                return;
            }

            try {
                const response = await fetch(`/api/barks/${barkId}/tag`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    await this.viewBarks(dogId);
                    await this.loadDogs();
                    await this.loadStats();
                    await this.loadUntaggedBarks();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.detail || 'Failed to untag bark'));
                }
            } catch (error) {
                console.error('Error untagging bark:', error);
                alert('Error untagging bark');
            }
        }

        escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    }

    // Global functions
    function closeEditModal() {
        document.getElementById('edit-modal').classList.remove('active');
    }

    function closeBarkModal() {
        document.getElementById('barks-modal').classList.remove('active');
    }

    // Initialize
    const admin = new DogsAdmin();
    </script>
</body>
</html>
